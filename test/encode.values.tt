<#@ template debug="false" hostspecific="true" language="C#" #>
<#@ assembly name="System.Core" #>
<#@ import namespace="System.Linq" #>
<#@ import namespace="System.Text" #>
<#@ import namespace="System.Collections.Generic" #>
<#@ output extension=".cs" #>
using System;
using System.Linq;
using Executioner;
using Objectoid;

namespace test
{
    internal partial class Cmd_encode
    {
        private static readonly Dictionary<ObjType, Func<string, ObjElement>> _CreateValuableElementMethods =
            new Dictionary<ObjType, Func<string, ObjElement>>
            {
                { ObjType.NullTerminatedString, s => {
                    try { return new ObjNTStringElement(new ObjNTString(s)); }
                    catch { throw new CommandFailedException($"\"{s}\" is not a valid null-terminated string value."); }
                }},
                { ObjType.String, s => {
                    return new ObjStringElement(s);
                }},
                { ObjType.RawBytes, s => {
                    try { return new ObjRawBytesElement(from ss in s.Split(_WhitespaceChars, StringSplitOptions.RemoveEmptyEntries) select byte.Parse(ss)); }
                    catch { throw new CommandFailedException($"\"{s}\" is not valid raw byte data."); }
                }},
<# CreateEntry(this, 4, "UInt8", "byte", "unsigned 8-bit integer"); #>
<# CreateEntry(this, 4, "Int8", "sbyte", "signed 8-bit integer"); #>
<# CreateEntry(this, 4, "UInt16", "ushort", "signed 16-bit integer"); #>
<# CreateEntry(this, 4, "Int16", "short", "signed 16-bit integer"); #>
<# CreateEntry(this, 4, "UInt32", "uint", "signed 32-bit integer"); #>
<# CreateEntry(this, 4, "Int32", "int", "signed 32-bit integer"); #>
<# CreateEntry(this, 4, "UInt64", "ulong", "signed 64-bit integer"); #>
<# CreateEntry(this, 4, "Int64", "long", "signed 64-bit integer"); #>
<# CreateEntry(this, 4, "Single", "float", "single-precision floating-point"); #>
<# CreateEntry(this, 4, "Double", "double", "double-precision floating-point"); #>
<# CreateEntry(this, 4, "Bool", "bool", "boolean"); #>
            };
    }
}

<#+

    static void CreateEntry(GeneratedTextTransformation text, int indent,
        string suffix, string literalName, string desc)
    {
		for (int i = 0; i < indent; i++) text.PushIndent("    ");

        text.WriteLine($"{{ ObjType.{suffix}, s => {{");
        text.WriteLine($"    if (!{literalName}.TryParse(s, out {literalName} value))");
        text.WriteLine($"        throw new CommandFailedException($\"\\\"{{s}}\\\" is not a valid {desc} value.\");");
        text.WriteLine($"    return new Obj{suffix}Element(value);");
        text.WriteLine($"}}}},");
		
		for (int i = 0; i < indent; i++) text.PopIndent();
    }

#>